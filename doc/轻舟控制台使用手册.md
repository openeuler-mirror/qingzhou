# 产品简介

## 概述
轻舟是一款开源的轻量级软件开发平台，其愿景是优化通用型Web管理软件的开发质量与效率，并实现不同类型软件的集中化统一管理。 基于轻舟开发Web管理软件，只需编写简单的Java Bean，即可自动获得业务模块对应的前端网页、REST接口、JMX接口、国际化等服务，并能开箱即用内置的用户管理、认证授权、监视自动化、文件上传下载、本地和远程集中管理、公共组件等能力。 在轻舟的架构里，管理一种类型的软件被设计为一种应用，应用可被按需地、灵活地插拔于轻舟平台之上，并获得可配置、可观测等效益，从而优化企业内部复杂的业务系统的管理工作。本手册将指导您如何使用控制台的各个模块。
## 安装运行
轻舟支持主流操作系统，如 Windows、Ubuntu、openEuler 或其他 Unix-Like 的发行版上。
### 先决条件
为了能正确安装和使用轻舟平台，你需要首先确保已经配置以下环境：
1.	Java 8 及以上版本
2.	Apache Maven 最新版本或推荐版本
### 拉取仓库
复制以下命令到终端执行 `git clone https://gitee.com/openeuler/qingzhou.git`
或直接下载压缩文件到本地解压
### 编译安装
在项目根目录执行 `mvn clean install` 命令，然后可在项目的 package/target/qingzhou 得到轻舟的安装包。
其中：
1.	bin：为轻舟的可执行程序目录，包含不同平台的脚本文件等；
2.	instances：为轻舟的实例存放目录，包含轻舟的配置文件和应用的业务数据等；
3.	lib：为轻舟的程序文件，以轻舟的版本号为规划，按目录存放。
### 启动服务
启动轻舟有两种方式，择其一即可：
1.	在 ${轻舟的安装包}/bin 下，执行对应平台的 start 脚本；
2.	执行命令：`java -jar ${轻舟的安装包}/bin/qingzhou-launcher.jar instance start`
      看到类似如下的日志输出，则表示启动完成：
      Open a browser to access the Qingzhou console: <http://localhost:9001/console>
### 访问控制台
1.	在浏览器地址中，输入如下地址，进入轻舟管理客户端登录页面。
```http request
http://<IP>:<Port>/console
``` 

> **说明:**
> 
> *IP：* 部署轻舟控制台的 IP 地址。
> 
> *Port：* 端口号，默认为 “9001”。
> 
> **注意：**
> 
>若遇到浏览器页面提示 IP 不受信任，可设置轻舟的配置文件`${轻舟的安装包}/instances/instance1/conf/qingzhou.json`， 修改其中的 trustedIp 值，指定一个浏览器IP正则表达式来信任特定的浏览器，设置为 * 表示信任所有浏览器。


2.	输入用户名、密码和验证码，并单击 “登录”，进入轻舟控制台首页。
       * 默认用户名：qingzhou
       * 默认初始密码：qingzhou123.com
      
> **注意：**
>
> 连续输入 5 次密码错误，用户将被锁定。

单击 “登录”，即可登录到轻舟控制台主页

## 导航栏
### 新手指引
为了用户可以快速了解轻舟的使用，轻舟提供了新手指引模块，在该模块可以通过“上一页”和“下一页”查看轻舟的使用技巧。

### 主题模式
为了满足不同用户的喜好，轻舟还提供了主题模式供用户切换。
### 切换语言
轻舟支持国际化（简体、繁体、英文），用户可以根据应用使用场景来切换不同的语言。
### 修改密码
用户登录后，可以修改当前登录用户的密码、动态密码。
#### 修改用户登录密码
修改用户登录密码时，首先要将“修改密码开关”设置为true，然后输入原始密码和新密码后，点击“更新”按钮完成用户登录密码的修改。

| 字段名      | 说明          |
|----------| ---------------------------------------------------------- |
| 修改密码     | 修改密码开关，true：表示需要修改密码，false：表示无需修改密码    |
| 原始密码     | 修改密码开关为true时生效，登录系统的原始密码。 |
| 新密码      | 修改密码开关为true时生效，用于登录系统的新密码。  |
| 确认密码     | 修改密码开关为true时生效，确认用于登录系统的新密码。  |
| 动态密码     | 用户开启动态密码，在登录系统时，输入动态密码，可免输入账户的密码。  |

#### 开启动态密码
开启动态密码需要使用TOTP客户端/TOTP微信小程序，本章节以TOTP微信小程序为例介绍绑定过程。
#####  打开二维码扫描页面
首先点击“刷新动态密码”按钮，会弹出二维码页面。
##### 使用TOTP客户端扫描二维码
1. 打开微信小程序搜索totp。
2. 选择“TOTP身份安全认证器”小程序，会进入小程序的首页。
3. 点击小程序首页中的“扫描二维码”，扫描轻舟上边弹出的二维码，扫描轻舟二维码后，小程序会显示qingzhou动态口令。
##### 完成动态口令绑定
将TOTP小程序中的动态口令（动态口令30秒更新一次）输入到轻舟二维码绑定页面，然后点击“确认”按钮完成绑定。
##### 点击更新，开启动态密码
完成TOTP动态口令绑定之后，点击“更新”按钮完成动态密码的开启。
##### 基于TOTP动态口令完成登录
再次登录时，可以选择免输入账户的密码，而是输入TOTP动态口令即可完成登录。
### 注销
点击“注销”按钮后，会退出当前用户并返回到登录页面。
## 业务管理
### 概览
概览页面用于监视所部署应用的运行情况，会展示实例数量、应用数量、系统负载、使用中堆内存、磁盘使用量等指标的实时变化情况。
概览页面不仅可以查看系统实时负载，还可以通过折线图来观察系统核心资源的变化趋势。
### 应用
这里的应用，是指一种按照“轻舟应用开发规范”编写的软件包，可安装在轻舟平台上，用于管理特定的业务系统。而应用模块用于部署和管理此类应用，关于应用的开发方式请参考“轻舟应用开发规范”。
#### 部署应用
部署应用时，可以从客户端上传，也可以从服务器端指定的位置读取。
##### 从客户端上传
1.	上传应用：上传一个应用文件到服务器，文件须是 *.jar 或 *.zip 类型的 Qingzhou 应用文件，否则可能会导致部署失败。
2.	部署实例，选择部署应用的实例，默认是在localhost实例。
3.	部署配置：如果需要，可以为部署应用添加所需的配置。
4.	点击部署按钮，完成应用部署。
##### 从服务器端指定的位置读取
1.	指定应用位置：服务器上应用程序的位置，通常是应用的程序包。
      注：须为 *.jar, *.zip 类型的文件或目录。
2.	部署实例，选择部署应用的实例，默认是在localhost实例。
3.	部署配置：如果需要，可以为部署应用添加所需的配置。
4.	点击部署按钮，完成应用部署。
#### 管理应用
应用部署完毕会展示在应用列表，如果部署了多个应用，可以根据应用名称和状态搜索目标应用。

在应用的操作列有四个操作按钮，分别是“管理”、“编辑”、“停止”、“卸载”。

**管理:** 
转到该应用的管理页面，比如tongeasy-console应用点击“管理”之后，会跳转到tongeasy-console应用的管理页面。

**编辑:** 点击后，会跳转到应用的编辑页面。

**停止:** 点击后，会停止该应用，应用状态会变为Stopped，停止不会删除应用包下的文件。

**卸载：** 卸载应用会删除应用包下的所有文件，且不可恢复。
### 实例
实例是应用部署的载体，为应用提供运行时环境。预置的 localhost 实例表示当前正在访问的服务所在的实例，如集中管理端就运行在此实例上。
实例列表同样支持组合条件查询，实例支持的操作有“监视”、“执行GC”、“下载日志”。
#### 监视
点击监视按钮后，会跳转到该实例的监视页面，该页面会展示实例的“系统负载”、“使用中堆内存”、“磁盘使用量”、“Jvm线程总数”、“死锁线程数”等核心指标的实时变化趋势。

以及部署该实例服务器的“操作系统信息”和“Java虚拟机”信息都会进行展示。
#### 执行GC
点击“执行GC”按钮后，会触发实例应用GC进行垃圾回收，该操作支持多选。
#### 下载日志
点击“下载日志”按钮会弹出日志选择弹框，可以根据需要进行选择，点击下载后，会将选中的日志以zip包的形式下载到本地。
#### 远程实例
轻舟不仅预置了localhost 实例来部署应用，还支持远程轻舟实例的注册，这种远程轻舟注册的实例称为“远程实例”。
##### 注册远程实例
1.	将package/target/qingzhou拷贝到远程服务器10.10.92.75上
2.	查看localhost 实例（ip：192.168.55.99）qingzhou.json配置文件的security.publicKey
3.  编辑远程服务器上的轻舟qingzhou.json配置文件
     - agent.enabled：修改为true，表示开启代理
     - agent.masterUrl：修改为localhost 实例所在的服务器ip地址192.168.55.99
     - agent.masterKey：修改为localhost 实例的security.publicKey

4.	sh start.sh启动远程服务器上的轻舟，在启动日志中会输出The agent service is started, host: 10.10.92.75, port: 5001，表示代理服务正常启动。
5. 查看localhost 实例（ip：192.168.55.99）的实例列表，可以看到远程实例注册成功。
##### 管理远程实例
远程实例注册成功之后，可以通过“监视”、“执行GC”、“下载日志”按钮来管理该远程实例。
###### 管理远程实例上的应用
1. 远程实例注册之后，在部署应用时，可以选择将应用部署在localhost实例或者远程实例上。
2. 部署成功之后，可以在应用列表页面，来管理远程实例上部署的应用。
3. 比如点击“管理”按钮，则会进入远程实例Example应用的主页。
###### 监视远程实例
在概览页面，会同时展示localhost实例和远程实例的实时运行情况。
## 开放服务
### 公共组件
轻舟为应用提供了一系列开箱即用的公共组件，包括简单日志服务、Java 序列化、二维码生成、Json 文件处理、加解密服务、Http 工具等，以提高业务系统的开发效率。使用轻舟的公共组件非常方便，只需调用 AppContext 对象的 getService 方法传入组件类型，即可获得相应的组件对象。

在公共组件列表页面，可以查看轻舟当前支持的所有公共组件。
## 系统设置
### 账户
账户模块用于管理登录和操作服务器的账户，账户可登录控制台、REST接口等。默认情况下，轻舟预置了qingzhou账户。
账户信息也可以在配置文件qingzhou.json中进行查看。
#### 创建账户
如果需要创建其他账户，可以点击“创建”按钮添加新账户。
添加账户时，各字段说明如下：

| 字段名       | 说明           | 
| ---------- | ---------------- |
| 账户名称     | 用于登录系统的用户名。       | 
| 账户密码       | 用于登录系统的账户密码。 |
| 确认密码     | 用于登录系统的账户密码。   |
| 摘要算法     | 进行摘要加密所采用的算法，默认SHA-256。  |
| 加盐长度     | 将自动生成的盐值和字符串一起加密可以提高加密强度，默认加盐长度4。   |
| 迭代次数     | 连续多次摘要加密可以提高加密强度，默认迭代5次。   |
| 下次登录须改密码     | 标记该用户下次登录系统后，须首先修改其登录密码，否则不能进行其它操作。   |
| 启用     | 若未启用，则无法登录服务器。   |
| 角色     | 为用户分配访问系统的权限。   |
| 描述     | 此账户的说明信息。   |

### 角色
角色的作用是定义应用的操作权限，用户可以通过创建角色来控制对应用模块的访问权限。
创建角色需要指定应用和系统模块，详细的字段解释如下：

| 字段名     | 说明          |
| -------- | --------------- |
| 名称     | 该角色的唯一标识。     | 
| 应用     | 指定该角色的权限作用到的应用。     | 
| 权限     | 角色的权限表示具有该角色的用户可以访问的资源（URI）集合。     | 
| 激活     | 是否激活该角色，激活后，拥有该角色的用户将可以访问该角色对应的资源，否则用户将无法访问对应的资源。     | 
| 描述     | 	该角色的描述说明信息。| 

### 安全
安全模块用于配置轻舟管理控制台的安全策略，可以根据需求来调整轻舟安全策略。

| 字段名     | 说明          |
| -------- | --------------- |
| 信任IP     | 指定信任的客户端 IP 地址，其值可为具体的 IP、匹配 IP 的正则表达式或通配符 IP（如：168.1.2.*，168.1.4.5-168.1.4.99）。远程的客户端只有在被设置为信任后，才可进行首次默认密码更改、文件上传等敏感操作。注：不设置表示只有当前的部署机受信任，设置为 * 表示信任所有机器。    |
| 失败锁定次数 | 用户连续认证失败后被锁定的次数。 |
| 锁定时长 | 用户在多次认证失败后被锁定的时间（秒）。 |
| 密码最长使用期限 | 用户登录系统的密码距离上次修改超过该期限（单位为天）后，需首先更新密码才能继续登录系统。 |
| 不使用最近密码 | 	限制本次更新的密码不能和最近几次使用过的密码重复。注：设置为 “1” 表示只要不与当前密码重复即可。|
### JMX
JMX 是 Java Management Extensions（Java管理扩展） 的缩写，它是 Java 平台上用于管理和监控应用程序、系统和网络资源的一种标准化的管理和监控框架。

JMX 提供了一种标准的方式，通过这种方式，开发人员可以暴露应用程序中的各种管理和监控信息，然后可以使用 JMX 客户端工具或应用程序来访问和操作这些信息。开启 JMX 接口服务后，客户端可以通过 java jmx 协议来管理 Qingzhou 平台。

| 字段名     | 说明          |
| -------- | --------------- |
| 启用    | 功能开关，配置是否开启 Qingzhou 的 JMX 接口服务。 |
| 服务IP | 指定 JMX 监听服务绑定的 IP 地址，为空表示绑定到 127.0.0.1。 |
| 服务端口 | 指定 JMX 监听服务绑定的端口。 |

### 版本
管理轻舟的运行版本，将轻舟升级到一个新的版本。**注：** 升级包会立即下发，但在实例下次重启时生效。

在进行版本升级时，需要指定升级包的位置，升级包可以从客户端上传，也可以从服务器端指定的位置读取。

| 字段名     | 说明          |
| -------- | --------------- |
| 使用上传    | 升级包可以从客户端上传，也可以从服务器端指定的位置读取。 |
| 文件位置 | 从服务器读取时生效，服务器上升级包的位置。注：须为 version*.zip 类型的文件。 |
| 上传文件 | 从客户端上传时生效，上传一个文件到服务器，文件须是 version*.zip 类型的文件，否则可能会导致升级失败。 |

指定完version*.zip升级包位置后，点击“升级”按钮即可完成版本升级。	